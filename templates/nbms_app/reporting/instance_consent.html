{% extends "nbms_app/base.html" %}
{% block title %}Consent Workspace{% endblock %}
{% block content %}
  <h1>Consent: {{ instance.cycle.code }} {{ instance.version_label }}</h1>
  <p class="muted">Only IPLC-sensitive items require consent.</p>

  <div class="card">
    <nav class="actions">
      <a href="#indicators">Indicators</a>
      <a href="#targets">National Targets</a>
      <a href="#evidence">Evidence</a>
      <a href="#datasets">Datasets</a>
    </nav>
  </div>

  <div class="card" id="indicators">
    <h2>Indicators</h2>
    <table>
      <thead>
        <tr>
          <th>Code</th>
          <th>Title</th>
          <th>Status</th>
          <th>Organisation</th>
          <th>Consent</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for item in indicator_items %}
          <tr>
            <td>{{ item.obj.code }}</td>
            <td>{{ item.obj.title }}</td>
            <td>{{ item.obj.status }}</td>
            <td>{{ item.obj.organisation|default:"-" }}</td>
            <td>{{ item.status }}</td>
            <td>
              <form method="post" enctype="multipart/form-data" action="{% url 'nbms_app:reporting_instance_consent_action' instance.uuid 'indicator' item.obj.uuid 'grant' %}">
                {% csrf_token %}
                <input type="text" name="note" placeholder="Note" />
                <input type="file" name="consent_document" />
                <button type="submit">Grant</button>
              </form>
              <form method="post" enctype="multipart/form-data" action="{% url 'nbms_app:reporting_instance_consent_action' instance.uuid 'indicator' item.obj.uuid 'revoke' %}">
                {% csrf_token %}
                <input type="text" name="note" placeholder="Note" />
                <input type="file" name="consent_document" />
                <button type="submit">Revoke</button>
              </form>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="6">No indicators requiring consent.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="card" id="targets">
    <h2>National Targets</h2>
    <table>
      <thead>
        <tr>
          <th>Code</th>
          <th>Title</th>
          <th>Status</th>
          <th>Organisation</th>
          <th>Consent</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for item in target_items %}
          <tr>
            <td>{{ item.obj.code }}</td>
            <td>{{ item.obj.title }}</td>
            <td>{{ item.obj.status }}</td>
            <td>{{ item.obj.organisation|default:"-" }}</td>
            <td>{{ item.status }}</td>
            <td>
              <form method="post" enctype="multipart/form-data" action="{% url 'nbms_app:reporting_instance_consent_action' instance.uuid 'target' item.obj.uuid 'grant' %}">
                {% csrf_token %}
                <input type="text" name="note" placeholder="Note" />
                <input type="file" name="consent_document" />
                <button type="submit">Grant</button>
              </form>
              <form method="post" enctype="multipart/form-data" action="{% url 'nbms_app:reporting_instance_consent_action' instance.uuid 'target' item.obj.uuid 'revoke' %}">
                {% csrf_token %}
                <input type="text" name="note" placeholder="Note" />
                <input type="file" name="consent_document" />
                <button type="submit">Revoke</button>
              </form>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="6">No national targets requiring consent.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="card" id="evidence">
    <h2>Evidence</h2>
    <table>
      <thead>
        <tr>
          <th>Title</th>
          <th>Status</th>
          <th>Organisation</th>
          <th>Consent</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for item in evidence_items %}
          <tr>
            <td>{{ item.obj.title }}</td>
            <td>{{ item.obj.status }}</td>
            <td>{{ item.obj.organisation|default:"-" }}</td>
            <td>{{ item.status }}</td>
            <td>
              <form method="post" enctype="multipart/form-data" action="{% url 'nbms_app:reporting_instance_consent_action' instance.uuid 'evidence' item.obj.uuid 'grant' %}">
                {% csrf_token %}
                <input type="text" name="note" placeholder="Note" />
                <input type="file" name="consent_document" />
                <button type="submit">Grant</button>
              </form>
              <form method="post" enctype="multipart/form-data" action="{% url 'nbms_app:reporting_instance_consent_action' instance.uuid 'evidence' item.obj.uuid 'revoke' %}">
                {% csrf_token %}
                <input type="text" name="note" placeholder="Note" />
                <input type="file" name="consent_document" />
                <button type="submit">Revoke</button>
              </form>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="5">No evidence requiring consent.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="card" id="datasets">
    <h2>Datasets</h2>
    <table>
      <thead>
        <tr>
          <th>Title</th>
          <th>Status</th>
          <th>Organisation</th>
          <th>Consent</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for item in dataset_items %}
          <tr>
            <td>{{ item.obj.title }}</td>
            <td>{{ item.obj.status }}</td>
            <td>{{ item.obj.organisation|default:"-" }}</td>
            <td>{{ item.status }}</td>
            <td>
              <form method="post" enctype="multipart/form-data" action="{% url 'nbms_app:reporting_instance_consent_action' instance.uuid 'dataset' item.obj.uuid 'grant' %}">
                {% csrf_token %}
                <input type="text" name="note" placeholder="Note" />
                <input type="file" name="consent_document" />
                <button type="submit">Grant</button>
              </form>
              <form method="post" enctype="multipart/form-data" action="{% url 'nbms_app:reporting_instance_consent_action' instance.uuid 'dataset' item.obj.uuid 'revoke' %}">
                {% csrf_token %}
                <input type="text" name="note" placeholder="Note" />
                <input type="file" name="consent_document" />
                <button type="submit">Revoke</button>
              </form>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="5">No datasets requiring consent.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <p><a href="{% url 'nbms_app:reporting_instance_detail' instance.uuid %}">Back to instance</a></p>
{% endblock %}

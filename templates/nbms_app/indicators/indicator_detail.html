{% extends "nbms_app/base.html" %}
{% block title %}Indicator{% endblock %}
{% block content %}
  <h1>{{ indicator.code }} - {{ indicator.title }}</h1>
  <div class="card">
    <p><strong>Status:</strong> {{ indicator.status }}</p>
    <p><strong>Sensitivity:</strong> {{ indicator.sensitivity }}</p>
    <p><strong>National target:</strong> {{ indicator.national_target }}</p>
    {% if can_edit %}
      <p><a href="{% url 'nbms_app:indicator_edit' indicator.uuid %}">Edit indicator</a></p>
    {% endif %}
  </div>
  <div class="card">
    <h2>Indicator Readiness</h2>
    <p><strong>Release readiness:</strong> {{ readiness.status|title }}</p>
    <h3>Core completeness</h3>
    <ul>
      {% for check in readiness.checks %}
        {% if check.key != "approval" and check.key != "consent" %}
          <li>{{ check.label }}: {{ check.state|title }}</li>
        {% endif %}
      {% endfor %}
    </ul>
    {% if indicator.review_note %}
      <p><strong>Review note:</strong> {{ indicator.review_note }}</p>
    {% endif %}
    <h3>Instance readiness</h3>
    {% if current_instance %}
      <p><strong>Current instance:</strong> {{ current_instance }}</p>
      <ul>
        <li>Approval: {{ readiness.details.approval_status|default:"not approved"|title }}</li>
        <li>Consent: {{ readiness.details.consent_status|default:"n/a"|title }}</li>
        <li>Eligible for export: {% if readiness.details.eligible_for_export %}Yes{% else %}No{% endif %}</li>
      </ul>
      {% if approvals_url %}<p><a href="{{ approvals_url }}">Go to instance approvals</a></p>{% endif %}
      {% if consent_url %}<p><a href="{{ consent_url }}">Go to consent workspace</a></p>{% endif %}
    {% else %}
      <p class="muted">Set a current reporting instance to see export readiness.</p>
    {% endif %}
  </div>
{% endblock %}
